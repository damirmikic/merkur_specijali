<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Mapping Manager - Merkur Specijali</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        
        .main { padding: 30px; }
        
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .section h3 { color: #2c3e50; margin-bottom: 15px; }
        
        .mapping-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .mapping-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }
        
        .mapping-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .team-name { 
            font-weight: 600; 
            color: #2c3e50; 
            margin-bottom: 10px; 
            font-size: 16px; 
        }
        
        .alias-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .alias-tag {
            background: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alias-tag .remove { 
            cursor: pointer; 
            font-weight: bold; 
            opacity: 0.7; 
        }
        
        .alias-tag .remove:hover { opacity: 1; }
        
        .add-form {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .add-form input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; }
        
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #219a52; }
        
        .new-team-form {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        
        .form-group { display: flex; flex-direction: column; }
        .form-group label { 
            font-size: 14px; 
            color: #495057; 
            margin-bottom: 5px; 
            font-weight: 500; 
        }
        
        .form-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .actions { 
            background: #f8f9fa; 
            padding: 20px; 
            border-top: 1px solid #e9ecef; 
            text-align: center; 
        }
        
        .test-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .test-section h4 { color: #856404; margin-bottom: 15px; }
        
        .test-input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            margin-bottom: 10px; 
        }
        
        .test-result {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .new-team-form {
                grid-template-columns: 1fr;
            }
            
            .mapping-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèà Team Mapping Manager</h1>
            <p>Configure team name mappings for injury data integration</p>
        </div>

        <div class="main">
            <!-- Current Mappings -->
            <div class="section">
                <h3>üèÜ Current Team Mappings</h3>
                <div id="mappings-container" class="mapping-grid">
                    <!-- Mappings will be loaded here -->
                </div>
            </div>

            <!-- Add New Team -->
            <div class="section">
                <h3>üÜï Add New Team</h3>
                <div class="new-team-form">
                    <div class="form-group">
                        <label for="new-team">Team Name</label>
                        <input type="text" id="new-team" placeholder="e.g., Manchester United">
                    </div>
                    <div class="form-group">
                        <label for="new-aliases">Aliases (comma separated)</label>
                        <input type="text" id="new-aliases" placeholder="Man United, MUFC, Manchester Utd">
                    </div>
                    <button class="btn btn-success" onclick="addNewTeam()">Add Team</button>
                </div>
            </div>

            <!-- Test Mapping -->
            <div class="test-section">
                <h4>üß™ Test Team Mapping</h4>
                <input type="text" id="test-input" class="test-input" placeholder="Enter team name to test mapping...">
                <button class="btn btn-primary" onclick="testMapping()">Test Mapping</button>
                <div id="test-result" style="display: none;"></div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-primary" onclick="saveToFile()">üíæ Save Mappings</button>
            <button class="btn btn-success" onclick="loadFromFile()">üì§ Load from File</button>
            <button class="btn btn-primary" onclick="resetToDefaults()">üîÑ Reset to Defaults</button>
        </div>
    </div>

    <script>
        let teamMappings = {};

        // Initialize with default mappings
        function initializeMappings() {
            teamMappings = {
                'Manchester United': ['Man United', 'MUFC', 'Man Utd', 'Manchester Utd'],
                'Manchester City': ['Man City', 'MCFC', 'City'],
                'Liverpool': ['Liverpool FC', 'LFC', 'The Reds'],
                'Arsenal': ['Arsenal FC', 'AFC', 'Gunners'],
                'Chelsea': ['Chelsea FC', 'CFC', 'Blues'],
                'Tottenham': ['Tottenham Hotspur', 'Spurs', 'THFC'],
                'Real Madrid': ['Real Madrid CF', 'Madrid', 'Los Blancos'],
                'Barcelona': ['FC Barcelona', 'Barca', 'FCB', 'Bar√ßa'],
                'Atletico Madrid': ['Atletico de Madrid', 'Atleti', 'Atletico'],
                'Juventus': ['Juventus FC', 'Juve', 'Juventus Turin'],
                'Inter Milan': ['Inter', 'Internazionale', 'Inter Milano'],
                'AC Milan': ['Milan', 'AC Milan', 'Rossoneri'],
                'Bayern Munich': ['Bayern M√ºnchen', 'FC Bayern', 'Bayern'],
                'Borussia Dortmund': ['BVB', 'Dortmund', 'Borussia'],
                'Paris Saint-Germain': ['PSG', 'Paris SG', 'Paris Saint Germain']
            };
        }

        // Load mappings from localStorage
        function loadMappings() {
            try {
                const stored = localStorage.getItem('teamMappings');
                if (stored) {
                    teamMappings = JSON.parse(stored);
                } else {
                    initializeMappings();
                }
            } catch (error) {
                console.error('Error loading mappings:', error);
                initializeMappings();
            }
            displayMappings();
        }

        // Display mappings
        function displayMappings() {
            const container = document.getElementById('mappings-container');
            container.innerHTML = '';

            for (const [team, aliases] of Object.entries(teamMappings)) {
                const card = document.createElement('div');
                card.className = 'mapping-card';

                const aliasesHtml = aliases.map(alias => `
                    <span class="alias-tag">
                        ${alias}
                        <span class="remove" onclick="removeAlias('${team}', '${alias}')">&times;</span>
                    </span>
                `).join('');

                card.innerHTML = `
                    <div class="team-name">${team}</div>
                    <div class="alias-tags">${aliasesHtml}</div>
                    <div class="add-form">
                        <input type="text" placeholder="Add alias" id="alias-${team.replace(/\s+/g, '-')}">
                        <button class="btn btn-primary" onclick="addAlias('${team}')">Add</button>
                    </div>
                `;

                container.appendChild(card);
            }
        }

        // Add alias to team
        function addAlias(team) {
            const input = document.getElementById(`alias-${team.replace(/\s+/g, '-')}`);
            const alias = input.value.trim();

            if (alias && !teamMappings[team].includes(alias)) {
                teamMappings[team].push(alias);
                input.value = '';
                displayMappings();
                saveMappings();
            }
        }

        // Remove alias from team
        function removeAlias(team, alias) {
            teamMappings[team] = teamMappings[team].filter(a => a !== alias);
            displayMappings();
            saveMappings();
        }

        // Add new team
        function addNewTeam() {
            const teamInput = document.getElementById('new-team');
            const aliasesInput = document.getElementById('new-aliases');

            const team = teamInput.value.trim();
            const aliases = aliasesInput.value.trim();

            if (!team) return;

            const aliasArray = aliases ? aliases.split(',').map(a => a.trim()).filter(a => a) : [];
            teamMappings[team] = aliasArray;

            teamInput.value = '';
            aliasesInput.value = '';

            displayMappings();
            saveMappings();
        }

        // Test mapping
        function testMapping() {
            const input = document.getElementById('test-input').value.trim();
            const result = document.getElementById('test-result');

            if (!input) return;

            const canonical = findCanonicalName(input);
            
            result.innerHTML = `
                <strong>Search:</strong> "${input}"<br>
                <strong>Maps to:</strong> ${canonical || 'No mapping found'}<br>
                <strong>Status:</strong> ${canonical ? '‚úÖ Found' : '‚ùå Not mapped'}
            `;
            result.style.display = 'block';
        }

        // Find canonical name (same logic as main app)
        function findCanonicalName(searchName) {
            const normalized = searchName.trim().toLowerCase();

            for (const [canonical, aliases] of Object.entries(teamMappings)) {
                if (canonical.toLowerCase() === normalized) {
                    return canonical;
                }

                if (aliases.some(alias => alias.toLowerCase() === normalized)) {
                    return canonical;
                }
            }

            for (const [canonical, aliases] of Object.entries(teamMappings)) {
                const allNames = [canonical, ...aliases].map(name => name.toLowerCase());

                for (const name of allNames) {
                    if (name.includes(normalized) || normalized.includes(name)) {
                        return canonical;
                    }
                }
            }

            return null;
        }

        // Save mappings to localStorage
        function saveMappings() {
            localStorage.setItem('teamMappings', JSON.stringify(teamMappings));
        }

        // Save to file
        function saveToFile() {
            const dataStr = JSON.stringify(teamMappings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'team-mappings.json';
            link.click();

            saveMappings();
            alert('Mappings saved to localStorage and file!');
        }

        // Load from file
        function loadFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            teamMappings = JSON.parse(e.target.result);
                            displayMappings();
                            saveMappings();
                            alert('Mappings loaded successfully!');
                        } catch (error) {
                            alert('Error loading file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };

            input.click();
        }

        // Reset to defaults
        function resetToDefaults() {
            if (confirm('Reset all mappings to defaults? This cannot be undone.')) {
                initializeMappings();
                displayMappings();
                saveMappings();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', loadMappings);
    </script>
</body>
</html>