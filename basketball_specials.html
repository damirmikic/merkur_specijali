<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Košarkaških Specijala</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #475569;
            font-weight: 500;
            font-size: 0.875rem;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #f9fafb;
            color: #1f2937;
        }
        .input-group input:disabled {
             background-color: #e5e7eb;
             cursor: not-allowed;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 700;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
            transform: translateY(0);
        }
        .action-btn:hover {
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
             transform: translateY(-2px);
        }
        .action-btn.primary {
            background-image: linear-gradient(to right, #3b82f6, #2563eb);
            color: white;
        }
        .action-btn.success {
            background-image: linear-gradient(to right, #22c55e, #16a34a);
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-xl border border-slate-200 shadow-sm">
            <header class="p-6 sm:p-8 flex items-center gap-4 border-b border-slate-200">
                <div class="bg-blue-100 text-blue-600 p-3 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-basketball"><circle cx="12" cy="12" r="10"/><path d="M4.2 14.2c.627.442 1.346.734 2.14.868"/><path d="M17.66 2.34c.2.63.34 1.3.34 2.01"/><path d="M21.66 14.25c-.134.8-.426 1.519-.868 2.146"/><path d="M1.95 12c0-.71.14-1.38.34-2.01"/><path d="M9.8 2.8c-.442.627-.734 1.346-.868 2.14"/><path d="M14.25 21.66c-.8.134-1.519.426-2.146.868"/><path d="M2.34 6.34a10.02 10.02 0 0 0-1.99 4.21"/><path d="M12 22.05c.71 0 1.38-.14 2.01-.34"/><path d="M3.4 17.66c-.63-.2-1.3-.34-2.01-.34"/><path d="M2.8 9.8a10.02 10.02 0 0 0 4.21-1.99"/><path d="M22.05 12c0 .71-.14 1.38-.34 2.01"/><path d="M17.66 20.6a10.02 10.02 0 0 0 1.99-4.21"/></svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-800">Generator Košarkaških Specijala</h1>
            </header>
            
            <div class="p-6 sm:p-8">
                <section class="mb-8 p-6 bg-slate-50 border border-slate-200 rounded-lg">
                    <h3 class="font-bold text-lg text-slate-800 mb-4">Učitavanje Mečeva sa API-ja</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="bball-match-select">Izaberi Meč</label>
                            <select id="bball-match-select">
                                <option>Učitavanje mečeva...</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="bball-domacin">Domaćin</label>
                            <input type="text" id="bball-domacin" placeholder="Domaćin će se pojaviti ovde" disabled>
                        </div>
                    </div>
                </section>

                <div class="flex flex-col md:flex-row justify-center items-center gap-4 my-8">
                     <button id="bball-generate-btn" class="w-full md:w-auto action-btn primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                        Generiši Specijal
                    </button>
                </div>

                 <div id="bball-preview-section" class="hidden">
                    <h2 class="text-xl sm:text-2xl font-bold text-slate-800 mb-6 text-center">Pregled Generisanog Specijala</h2>
                    <div class="overflow-x-auto rounded-lg border border-slate-200">
                        <table class="min-w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">MATCH_NAME</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">LEAGUE_NAME</th>
                                </tr>
                            </thead>
                            <tbody id="bball-preview-table-body" class="bg-white"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-center mt-8">
                        <button id="bball-download-csv-btn" class="w-full md:w-auto action-btn success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download-cloud"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path><path d="M12 12v9"></path><path d="m8 17 4 4 4-4"></path></svg>
                            Preuzmi CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bballMatchSelect = document.getElementById('bball-match-select');
            const bballDomacinInput = document.getElementById('bball-domacin');
            const bballGenerateBtn = document.getElementById('bball-generate-btn');
            const bballDownloadCsvBtn = document.getElementById('bball-download-csv-btn');
            const bballPreviewSection = document.getElementById('bball-preview-section');
            const bballPreviewTableBody = document.getElementById('bball-preview-table-body');

            let bballSelectedMatch = null;
            let bballGeneratedSpecials = [];

            const bballSpecialsToGenerate = [
                'Ukupno skokova', 'Ukupno asistencija', 'Ukupno postignutih 3P',
                'Ukupno izgubljenih lopti', '1. minut oba tima daju kos', '1. min oba tima daju trojku',
                'Igrac postize 20+ poena', '1. min 3+ poena', '1. min 4+ poena'
            ];

            async function fetchBasketballApiEvents() {
                try {
                    const response = await fetch('/api/basketball-events');
                    if (!response.ok) throw new Error(`API greška: ${response.statusText}`);
                    
                    const data = await response.json();
                    
                    if (data.events && data.events.length > 0) {
                        bballMatchSelect.innerHTML = '<option value="">-- Izaberi Meč --</option>';
                        data.events.forEach(event => {
                            const option = document.createElement('option');
                            option.value = JSON.stringify({
                                name: event.name,
                                home: event.competitors.find(c => c.home).name,
                            });
                            option.textContent = event.name;
                            bballMatchSelect.appendChild(option);
                        });
                    } else {
                        bballMatchSelect.innerHTML = '<option value="">Nema dostupnih mečeva</option>';
                    }
                } catch (error) {
                    console.error('Greška pri učitavanju košarkaških mečeva:', error);
                    bballMatchSelect.innerHTML = '<option value="">Greška pri učitavanju</option>';
                }
            }

            function generateBballSpecials() {
                if (!bballSelectedMatch) {
                    alert('Molimo Vas izaberite košarkaški meč.');
                    return;
                }
                bballGeneratedSpecials = bballSpecialsToGenerate;
                bballPreviewTableBody.innerHTML = '';
                bballGeneratedSpecials.forEach(special => {
                    const row = bballPreviewTableBody.insertRow();
                    row.className = 'bg-white even:bg-slate-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${bballSelectedMatch.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${special}</td>
                    `;
                });
                bballPreviewSection.classList.remove('hidden');
            }

            function downloadBballCsv() {
                if (!bballSelectedMatch || bballGeneratedSpecials.length === 0) {
                    alert('Molimo Vas prvo generišite specijal.');
                    return;
                }
                let csvContent = "MATCH_NAME,LEAGUE_NAME\n";
                bballGeneratedSpecials.forEach(special => {
                    const matchName = `"${bballSelectedMatch.name.replace(/"/g, '""')}"`;
                    const leagueName = `"${special.replace(/"/g, '""')}"`;
                    csvContent += `${matchName},${leagueName}\n`;
                });
                
                const blob = new Blob([`\uFEFF${csvContent}`], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const fileName = bballSelectedMatch.name.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '_specials.csv';
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            bballMatchSelect.addEventListener('change', function() {
                if (this.value) {
                    bballSelectedMatch = JSON.parse(this.value);
                    bballDomacinInput.value = bballSelectedMatch.home;
                    bballPreviewSection.classList.add('hidden');
                } else {
                    bballSelectedMatch = null;
                    bballDomacinInput.value = '';
                    bballPreviewSection.classList.add('hidden');
                }
            });

            bballGenerateBtn.addEventListener('click', generateBballSpecials);
            bballDownloadCsvBtn.addEventListener('click', downloadBballCsv);

            // Inicijalno učitavanje mečeva
            fetchBasketballApiEvents();
        });
    </script>
</body>
</html>
